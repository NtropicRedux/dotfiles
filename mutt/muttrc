######################
### muttrc
### by Brian Thompson <brian@hashvault.io>
###
# Source default account configuration

set realname = "Brian Thompson"
#set pgp_default_key = 0x84DF804D67D19AA2
set pgp_default_key = 0x6895BD545C79E897

# Imap settings
set imap_user = 'lt@hashvault.io'

# Smtp settings
set smtp_url = 'smtps://lt@hashvault.io@smtp.gmail.com'
set smtp_authenticators = "login"

macro index 1 "change-folder> =../debian/inbox/<enter>"
macro index G "!mbsync -a^M" "Update through mbsync"
unset move

# Import smtp and imap credentials
source "gpg -dq ~/.mutt/gmail.gpg |"

# Remote gmail folders
set folder = "~/.mutt/mailbox/debian"
set spoolfile = "~/.mutt/mailbox/debian/all"
set postponed = "~/.mutt/mailbox/debian/drafts"
set record = ""
set trash = "+/trash"
#set mbox="+mbox"

### Identity
# For using the entire hashvault.io domain
alternates "@hashvault\.io"
set reverse_name

### Pager
ignore *
unignore From Message-ID Date To Cc Bcc Subject
set pager_stop
unset markers
# Prefer plain text to html + helps with dumb clients
alternative_order multipart/mixed multipart/related text/plain
# Consult mime.types for determining types of these attachments
mime_lookup application/octet-stream

### Index
set quit = ask-yes
set sort = threads
# Remember to `mkdir -p ~/.mutt/hcache` first
set header_cache="~/.mutt/hcache"

### Message composition
set edit_headers
set mime_type_query_command = "xdg-mime query filetype"
set sendmail = "/usr/bin/msmtp"
# lbdb is a versatile contact query tool.  Invoke via ctrl-t in an
# address prompt.
set query_command = "/usr/bin/lbdbq"

### Other
set indent_string = ">"
set reflow_wrap = 80
set reflow_text
unset reflow_space_quotes

set imap_keepalive = 60
unset imap_passive
set imap_check_subscribed
set mail_check = 15
set timeout = 15

set sidebar_visible = no
set sidebar_width = 30
color sidebar_new brightred default
# b toggles sidebar visibility
macro index b '<enter-command>toggle sidebar_visible<enter>'
macro pager b '<enter-command>toggle sidebar_visible<enter>'

set ssl_starttls
unset ssl_use_sslv3
unset ssl_use_tlsv1
set ssl_verify_dates
set ssl_verify_host

macro index <esc>m "T~N<enter>;WNT~O<enter>;WO\CT~T<enter>" "mark all messages read"

# What we consider to be a quote.
set quote_regexp="^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
set to_chars=" +TCF "                     # Drop the "L".

source ~/.gnupg/gpg.rc         # Use GPG

# Last, but not least, get mutt to display its version on startup.
push <show-version>
message-hook '!(~g|~G) ~b"^-----BEGIN\ PGP\ (SIGNED\ )?MESSAGE"' "exec check-traditional-pgp"
auto_view text/html                       # eg with links --dump

set ssl_force_tls = yes
set abort_nosubject = yes
set sort = "reverse-date-received"
set copy = no
set editor = "vim -S ~/.mutt/vimrc"

set pgp_sign_as = "Brian Thompson"
set pgp_use_gpg_agent
set pgp_timeout=1800
set crypt_autosign
set crypt_replysign
set crypt_replysignencrypted

# macros
macro index gd "<change-folder>$postponed<enter>" "go to drafts"
macro index gs "<change-folder>$record<enter>" "go to sent"
macro index gi "<change-folder>$spoolfile<Enter>" "go to inbox"
macro index gt "<change-folder>$trash<enter>" "go to trash""
macro index,pager A "<save-message>=Archive<enter>" "Archive Message"

# system
set alias_file = "$HOME/.mutt/aliases"
set check_new
set editor = vim
set mail_check = 30
set mh_purge
set shell = "/usr/bin/zsh"
set timeout = 60

# folder
unset confirmappend
unset confirmcreate
set delete
set keep_flagged 
set save_address
set save_name

# index
set mark_old
set read_inc

# pager
set smart_wrap
set wrap = 80

# header
set from = "lt@hashvault.io"
set hostname = "brians-debian"
set use_from

# body
set signature = "~/.mutt/signature"

# compose
set abort_nosubject
set abort_unmodified
unset askcc
set edit_hdrs
set honor_followup_to
set postpone

# thread
unset duplicate_threads

# remote
set connect_timeout = 60
set ascii_chars

